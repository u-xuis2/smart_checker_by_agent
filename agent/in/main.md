# 大目標

HDDやSSDのsmartの結果を定期的にチェックします。
まずその結果を定期的に保持します。
その結果を１日前と比較、一週間前の平均、先月の平均と比較をLLMに対して実施させます。
pythonで作成します。
状況を確認するためのWebUIは不要です。

## 仕様

## 設定ファイル

* settings.jsonを設定ファイルとするが、gitには登録しないようにする。
* settings.json.templeteを用意する。こちらはgitに登録する。

### 定期取得部

常駐プロセスとして起動しHDDやSSDのsmartの結果を定期的にチェックします。
ただデーモン化はしないで良いです。それはsupirvisorに実現せますので、フォアグラウンドプロセスとして停止しないという意味での常駐プロセスとなります。

取得間隔は１時間に一回とします。が、設定にしてください。
取得した情報はファイルに保存します。月毎のディレクトリを切ってください。
自動でのログ削除処理も盛り込んでください２年より前のファイルは削除します。こちらも設定にします。

SMARTの結果は次のコマンドを使います。
smartctlにたいするsudoの設定は手動で実施しておきます。

sudo smartctl  -d sat -A /dev/sde -j

対象のデバイスは自動で列挙してください。できれば-d satが必要かも同様です。
対象デバイスはHDD/SDDだけが対象を対象とします。絞り込んで不要なデバイスに対しては実施しないようにしてください。
この処理は連続して実行せずデバイスごとに少し待機を入れてください。


### 判定処理部

判定処理は１日１回実施します。これも設定可能とします。
取得した結果をまず、簡単なTSV形式にして、それ単体でLLMに対して変なところがないかを問い合わせます。ある場合はアラートを上げるような回答を得るプロンプトを作ってください。
このLLMはGeminiを使います。
REST APIで実施して、対象のモデルと、APIキーは設定で指定できるようにしてください。
こちらは設定ファイルに平文保存で良いです。

次に、一日前の平均値を集計した値リストと、新たに取得した結果を比較して、おかしなところがないかを問い合わせます。ある場合はアラートを上げるような回答を得るプロンプトを作ってください。
これを先週の平均値、先月ｎ平均値と同じ処理を行います。
つまり、４回判定処理をLLMに問い合わせます。
十分なデータがない場合は、その範囲はスキップしてください。

その結果、アラートがある場合は、設定に指定されたコマンドを実行します。
これは引数に対象のデバイスを指定して、呼び出すだけで良いです。

またこのLLMに問い合わせる内容と結果は専用のログ出力先を作って、記録に残すようにしてください。
念の為に一回あたりのLLM呼び出す最大値を設定可能としてください。初期値は32でよいです。

## 補助CLI

CLIで即時に取得や判定処理を実行するコマンドを用意する。
CLIは処理種別に別ファイルで用意する。

## 失敗時のアラート通知

こちらも、何らかの問題が起きたときには、設定で指定されたコマンドを呼び出します。
第一引数に理由を設定して呼び出すだけで良いです。

## その他

設定の反映はプロセス再起動で良いです。リロード機構は不要です。
保存はファイルで実施してください。DBは想定しないで良いです。
ヘルスチェック機能は不要
LLMの設定を入れないとテストはできないと思うので、その部分の自動テストは不要です。
